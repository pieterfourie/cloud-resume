name: Frontend Deploy
on:
  push:
    paths: ["frontend/**", ".github/workflows/frontend-deploy.yml"]
    branches: ["main"]

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
      - uses: actions/checkout@v4
      - uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_ROLE_ARN }}
          aws-region: eu-north-1
      - name: Sync to S3
        run: aws s3 sync frontend s3://pfourie-com-site --delete --cache-control "max-age=60"
      - name: Invalidate CloudFront
        run: aws cloudfront create-invalidation --distribution-id ${{ secrets.CF_DISTRIBUTION_ID }} --paths "/*"
